#!/bin/bash

date=$(date +%d-%m-%y)

pacman -Qe > /tmp/installedPackages

# TODO : change this script

if ping -c 1 -W 1 jservlocal
then
	rsync -urv --progress --delete / -e ssh  jserv@jservlocal:/home/jserv/site2/ --files-from=/home/jerome/.config/jsaveconfig
	ssh jserv@jservlocal 'echo "$(date)" >> /home/jserv/site2/.log'
	ssh jserv@jservlocal 'chmod 766 /home/jserv/site2/ -R'
	rsync /tmp/installedPackages jserv@jservlocal:/home/jserv/bcrypted/saveconfig/ --progress -urv
else
	rsync -urv --progress --delete / -e ssh jserv@jserv:/home/jserv/site2/ --files-from=/home/jerome/.config/jsaveconfig
	ssh jserv@jserv 'echo "$(date)" >> /home/jserv/site2/.log'
	ssh jserv@jserv 'chmod 766 /home/jserv/site2/ -R'
	rsync /tmp/installedPackages jserv@jserv:/home/jserv/bcrypted/saveconfig/ --progress -urv
fi

